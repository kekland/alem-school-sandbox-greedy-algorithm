(()=>{var t={196:(t,e,s)=>{var a=s(147),n="";t.exports=function(){0===n.length&&(n=function(t){var e=Buffer.alloc(256),s=Buffer.alloc(256),n=0,o=0,i=!1,r=process.stdin.fd,c=!1;try{r=a.openSync("/dev/stdin","rs+"),c=!0}catch(t){}for(;;){try{o=a.readSync(r,e,0,256,null);var l=Buffer.alloc(n+o);s.copy(l,0,0,n),e.copy(l,n,0,o),s=l,n+=o;for(var u=0;u<o;u++)if(e[u]===t){i=!0;break}if(i)break}catch(t){if("EOF"===t.code)break;if("EAGAIN"===t.code)continue;throw t}if(0===o)break}return c&&a.closeSync(r),s}("\n".charCodeAt(0)).toString("utf-8"));var t=n.search("\n")+1,e=n.slice(0,t);return n=n.slice(t),e.trim()}},601:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Constants=void 0,e.Constants={coinPayoff:1,daggerPayoff:4,criticalDaggerPayoff:1e7,pathSafetyRelativeDangerScale:.5,pathSafetyRelativeDangerThreshold:3.5,pathSafetyDangerousMultiplier:.1,safetyPayoff:1e4,killPayoff:4,bonusPayoff:4,daggerLife:15,bonusLife:15,daggerEquippedLife:15,bonusEquippedLife:30,safetyThreshold:4,safetyIterationDepth:6,defaultVisibilityRadius:5}},836:(t,e,s)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.actionListToString=e.actionToVector2=e.inverseAction=e.Action=void 0;const a=s(561);var n;!function(t){t.left="left",t.right="right",t.up="up",t.down="down",t.stay="stay"}(n=e.Action||(e.Action={})),e.inverseAction=t=>{switch(t){case n.left:return n.right;case n.right:return n.left;case n.up:return n.down;case n.down:return n.up;default:return n.stay}},e.actionToVector2=t=>{switch(t){case n.left:return new a.Vector2(-1,0);case n.right:return new a.Vector2(1,0);case n.up:return new a.Vector2(0,-1);case n.down:return new a.Vector2(0,1);default:return new a.Vector2(0,0)}},e.actionListToString=t=>t.join(", ")},247:(t,e)=>{"use strict";function s(t){return void 0!==t.id&&void 0!==t.position}Object.defineProperty(e,"__esModule",{value:!0}),e.isMonster=e.isPlayer=e.isEntity=void 0,e.isEntity=s,e.isPlayer=t=>s(t)&&"player"===t.type,e.isMonster=t=>s(t)&&"monster"===t.type},916:(t,e)=>{"use strict";var s;Object.defineProperty(e,"__esModule",{value:!0}),e.stringToBlock=e.getBlockName=e.Block=void 0,function(t){t.empty=".",t.wall="!",t.coin="#",t.dagger="d",t.bonus="b"}(s=e.Block||(e.Block={})),e.getBlockName=t=>{switch(t){case s.empty:return"empty";case s.wall:return"wall";case s.coin:return"coin";case s.dagger:return"dagger";case s.bonus:return"bonus"}},e.stringToBlock=t=>{switch(t){case".":return s.empty;default:return s.wall;case"#":return s.coin;case"d":return s.dagger;case"b":return s.bonus}}},532:function(t,e,s){"use strict";var a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.getState=void 0;const n=s(561),o=s(916),i=a(s(196)),r=s(601);e.getState=({history:t})=>{var e,s;const a=t.length>0?t[t.length-1]:null;let c,l,u,f,p=(0,i.default)();[c,l,u,f]=p.split(" ").map((t=>parseInt(t)));const y=[];for(let t=0;t<l;t++){const t=(0,i.default)().split("").map((t=>(0,o.stringToBlock)(t)));y.push(t)}const d=parseInt((0,i.default)()),g={},h={};for(let t=0;t<d;t++){const o=(0,i.default)().split(" "),c=o[0],l=parseInt(o[1]),u=parseInt(o[2]),p=parseInt(o[3]),y=parseInt(o[4]),d=parseInt(o[5]);if("m"===c)g[t]={type:"monster",id:t,position:new n.Vector2(u,p)};else if("p"===c){const t={type:"player",id:l,position:new n.Vector2(u,p),dagger:null,bonus:null},o=(t,e)=>e?{firstTick:e.firstTick,ticksLeft:e.ticksLeft-1}:{firstTick:f,ticksLeft:t};1===y&&(t.dagger=o(r.Constants.daggerEquippedLife,null===(e=null==a?void 0:a.players[l])||void 0===e?void 0:e.dagger)),1===d&&(t.bonus=o(r.Constants.bonusEquippedLife,null===(s=null==a?void 0:a.players[l])||void 0===s?void 0:s.bonus)),h[l]=t}}const b=[o.Block.dagger,o.Block.bonus],v=[];for(let t=0;t<y.length;t++)for(let e=0;e<y[t].length;e++){const s=new n.Vector2(e,t),o=a?a.map.blockStates.find((t=>t.position.equals(s))):null,i=b.includes(y[t][e]);o&&i?v.push(o):!o&&i&&v.push({position:s,firstTick:f})}return{tick:f,playerId:u,monsters:g,players:h,map:{width:c,height:l,blocks:y,blockStates:v}}}},84:(t,e,s)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.resolveBonusIntent=void 0;const a=s(601),n=s(656),o=s(73);e.resolveBonusIntent=({state:t,player:e,paths:s,safetyMatrix:i})=>{const r=[];for(const c of s){const s=t.map.blockStates.find((t=>t.position.equals(c.end))),l=a.Constants.bonusLife-(t.tick-s.firstTick);if(c.actions.length>=l)continue;const u=(0,n.isPathSafeWithDagger)({daggerState:e.dagger,path:c})?1:(0,o.getPathSafety)({path:c,safetyMatrix:i});r.push({actions:c.actions,certainty:u,duration:c.actions.length,payoff:a.Constants.bonusPayoff,target:c.end,validateSafety:!0})}return r}},585:(t,e,s)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.resolveCoinIntent=void 0;const a=s(601),n=s(656),o=s(73);e.resolveCoinIntent=({state:t,player:e,paths:s,safetyMatrix:i})=>{const r=[];for(const t of s){const s=(0,n.isPathSafeWithDagger)({daggerState:e.dagger,path:t})?1:(0,o.getPathSafety)({path:t,safetyMatrix:i});r.push({actions:t.actions,certainty:s,duration:t.actions.length,payoff:a.Constants.coinPayoff*(null!=e.bonus?2:1),target:t.end,validateSafety:!0})}return r}},686:(t,e,s)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.resolveDaggerIntent=void 0;const a=s(601),n=s(73);e.resolveDaggerIntent=({state:t,player:e,paths:s,safetyMatrix:o})=>{const i=o[e.position.y][e.position.x],r=[];for(const e of s){const s=t.map.blockStates.find((t=>t.position.equals(e.end))),c=a.Constants.daggerLife-(t.tick-s.firstTick);if(e.actions.length>=c)continue;let l=!0;(0,n.simulatePath)(e,((t,e)=>{o[e.y][e.x]<=t+2&&(l=!1)}));const u=(0,n.getPathSafety)({path:e,safetyMatrix:o});r.push({actions:e.actions,certainty:l?1:u,duration:e.actions.length,payoff:i<=a.Constants.safetyThreshold&&l?a.Constants.criticalDaggerPayoff:a.Constants.daggerPayoff,target:e.end,validateSafety:!0})}return r}},458:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0})},958:(t,e,s)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.resolveKillIntent=void 0;const a=s(601);e.resolveKillIntent=({state:t,paths:e,player:s,safetyMatrix:n})=>{if(null==s.dagger)return[];const o=[];for(const t of e){const e=t.actions.length;s.dagger.ticksLeft<e/1.5||e<=4&&o.push({certainty:1,actions:t.actions,duration:t.actions.length,payoff:a.Constants.killPayoff,target:t.end,validateSafety:!1})}return o}},989:(t,e,s)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.resolveSafetyIntent=e.escapePathsFromPosition=e.isInDanger=void 0;const a=s(601),n=s(656),o=s(857),i=s(73),r=s(974);e.isInDanger=({position:t,player:e,safetyMatrix:s,visibilityMatrix:n})=>{const o=s[t.y][t.x],i=n[t.y][t.x];return!(o>=a.Constants.safetyThreshold||o>3&&!i||null!=e.dagger&&e.dagger.ticksLeft>4)},e.escapePathsFromPosition=({position:t,player:s,state:c,dangers:l,safetyMatrix:u,visibilityMatrix:f})=>{if(!(0,e.isInDanger)({position:t,player:s,safetyMatrix:u,visibilityMatrix:f}))return null;const p={};for(const t of l)p[l.indexOf(t)]=t;const y={},d={},g=t=>!(t.x<0||t.y<0||t.x>=c.map.width||t.y>=c.map.height||c.map.blocks[t.y][t.x]===n.Block.wall);return(0,o.iterateOnGameMapBranched)({start:t,blocks:c.map.blocks,maxDepth:a.Constants.safetyIterationDepth,callback:(t,e)=>{const a=e.length,o=e.slice(0,a-1),l=(0,n.actionListToString)(e),u=(0,n.actionListToString)(o),f=(t.sub((0,n.actionToVector2)(e[e.length-1])),null!=y[u]?Object.assign({},y[u]):Object.assign({},p));for(const e in f)if(f[e].equals(t))return!0;const h=[];for(const e in f){const s=f[e];(0,r.manhattanDistance)(s,t)<=8&&h.push(e)}for(const e of h){const s=f[e],a=[n.Action.left,n.Action.right,n.Action.up,n.Action.down];let o,i=1/0;for(const e of a){const r=s.add((0,n.actionToVector2)(e));if(!g(r))continue;let l=0;for(const e of a){const s=t.add((0,n.actionToVector2)(e));g(s)&&(l+=(0,n.calcuateSafety)({blocks:c.map.blocks,position:s,dangers:[r]}))}l<i&&(i=l,o=e)}const r=s.add((0,n.actionToVector2)(o));f[e]=r}if(0===a)return!1;y[l]=Object.assign({},f);const b=(0,n.calcuateSafety)({blocks:c.map.blocks,position:t,dangers:Object.values(f)});if(b<=1)return!0;let v=0;const k={actions:e,start:s.position,end:t,type:"safety"};return(0,i.simulatePath)(k,((t,e)=>{c.map.blocks[e.y][e.x]===n.Block.coin&&v++})),d[l]={path:k,safety:b,coinsCollected:v},!1}}),Object.values(d).filter((t=>t.path.actions.length>1))},e.resolveSafetyIntent=({state:t,paths:s,player:n,safetyMatrix:o,visibilityMatrix:i})=>{const r=(0,e.escapePathsFromPosition)({dangers:s.map((t=>t.end)),player:n,position:n.position,safetyMatrix:o,state:t,visibilityMatrix:i});return null==r?[]:r.map((t=>({payoff:a.Constants.safetyPayoff+.5*t.safety+t.coinsCollected,certainty:1,duration:1,actions:t.path.actions,target:t.path.end,validateSafety:!1})))}},656:function(t,e,s){"use strict";var a=this&&this.__createBinding||(Object.create?function(t,e,s,a){void 0===a&&(a=s),Object.defineProperty(t,a,{enumerable:!0,get:function(){return e[s]}})}:function(t,e,s,a){void 0===a&&(a=s),t[a]=e[s]}),n=this&&this.__exportStar||function(t,e){for(var s in t)"default"===s||Object.prototype.hasOwnProperty.call(e,s)||a(e,t,s)};Object.defineProperty(e,"__esModule",{value:!0}),n(s(836),e),n(s(247),e),n(s(916),e),n(s(532),e),n(s(458),e),n(s(388),e),n(s(154),e),n(s(410),e),n(s(561),e),n(s(165),e)},388:(t,e,s)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.iterateOnGameMap=e._traversalActionsHorizontalPriority=e._traversalActionsVerticalPriority=void 0;const a=s(836),n=s(916);e._traversalActionsVerticalPriority=[a.Action.up,a.Action.down,a.Action.left,a.Action.right],e._traversalActionsHorizontalPriority=[a.Action.left,a.Action.right,a.Action.up,a.Action.down],e.iterateOnGameMap=({start:t,blocks:s,maxDepth:o,callback:i,verticalPriority:r})=>{const c=null!=o?o:1e3,l=[];for(let t=0;t<s.length;t++){l.push([]);for(let e=0;e<s[t].length;e++)l[t].push(!1)}const u=[{position:t,actions:[],depth:0}],f=null==r||r?e._traversalActionsVerticalPriority:e._traversalActionsHorizontalPriority;for(;u.length>0;){const t=u.shift();if(!t)break;const{position:e,actions:o,depth:r}=t;if(!(r>c)&&!i(e,o))for(const t of f){const i=e.add((0,a.actionToVector2)(t));(p=i).x>=0&&p.y>=0&&p.x<s[0].length&&p.y<s.length&&!(t=>s[t.y][t.x]===n.Block.wall)(p)&&!l[p.y][p.x]&&(u.push({position:i,actions:[...o,t],depth:r+1}),l[i.y][i.x]=!0)}}var p}},857:(t,e,s)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.iterateOnGameMapBranched=e._traversalActions=void 0;const a=s(656);e._traversalActions=[a.Action.up,a.Action.down,a.Action.left,a.Action.right],e.iterateOnGameMapBranched=({start:t,blocks:s,maxDepth:n,callback:o})=>{const i=null!=n?n:4,r=t=>t.x>=0&&t.y>=0&&t.x<s[0].length&&t.y<s.length&&!(t=>s[t.y][t.x]===a.Block.wall)(t),c=(t,s,n,o,l)=>{for(const u of e._traversalActions.filter((t=>t!==(0,a.inverseAction)(o[o.length-1])))){const e=t.add((0,a.actionToVector2)(u));n<i&&r(e)&&!l(e,[...o,u])&&c(e,s,n+1,[...o,u],l)}};c(t,s,0,[],o)}},73:(t,e,s)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.calculateShortestPath=e.getPathSafety=e.simulatePath=e.isPathEntity=e.isPathBlock=e.pathToString=void 0;const a=s(601),n=s(656);e.pathToString=t=>`${t.type} ${t.start.x} ${t.start.y} ${t.end.x} ${t.end.y} ${t.actions.map(n.actionToVector2).join(" ")}`,e.isPathBlock=t=>"block"===t.type,e.isPathEntity=t=>"entity"===t.type,e.simulatePath=(t,e)=>{let s=t.start,a=0;for(const o of t.actions)e(a,s),s=s.add((0,n.actionToVector2)(o)),a+=1},e.getPathSafety=({path:t,safetyMatrix:s})=>{let n=1;return(0,e.simulatePath)(t,((t,e)=>{s[e.y][e.x]-t*a.Constants.pathSafetyRelativeDangerScale<=a.Constants.pathSafetyRelativeDangerThreshold&&(n*=a.Constants.pathSafetyDangerousMultiplier)})),n},e.calculateShortestPath=({start:t,end:e,blocks:s,verticalPriority:a})=>{let o;return(0,n.iterateOnGameMap)({start:t,blocks:s,verticalPriority:a,callback:(s,a)=>(s.equals(e)&&(o={type:"position",start:t,end:e,actions:a}),void 0!==o)}),o}},816:(t,e,s)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getDangerousPointsOfInterest=e.getPointsOfInterestWithSafety=e.getPointsOfInterest=void 0;const a=s(656),n=s(388),o=[a.Block.coin,a.Block.dagger,a.Block.bonus];e.getPointsOfInterest=({start:t,blocks:e,entities:s,predicate:a})=>{const i=[],r={};return(0,n.iterateOnGameMap)({start:t,blocks:e,callback:(n,c)=>{if(a&&a(n))return!0;const l=e[n.y][n.x],u=s.find((t=>t.position.x===n.x&&t.position.y===n.y));return o.includes(l)&&i.push({type:"block",start:t,end:n,actions:c,target:l}),null!=u&&(r[u.id]={type:"entity",start:t,end:n,actions:c,target:u.id}),!1}}),{blocks:i,entities:r}},e.getPointsOfInterestWithSafety=({start:t,blocks:s,safetyMatrix:a,visibilityMatrix:n,entities:o})=>(0,e.getPointsOfInterest)({start:t,blocks:s,entities:o,predicate:t=>a[t.y][t.x]<=4||!n[t.y][t.x]}),e.getDangerousPointsOfInterest=({poi:t,safePoi:e})=>{const s={blocks:[],entities:{}};for(const a of t.blocks)null==e.blocks.find((t=>t.end.equals(a.end)))&&s.blocks.push(a);for(const a of Object.values(t.entities))null==e.entities[a.target]&&(s.entities[a.target]=a);return s}},154:(t,e,s)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isPathSafeWithDagger=e.calcuateSafety=e.calculateSafetyMatrix=void 0;const a=s(388);e.calculateSafetyMatrix=({blocks:t,dangers:e})=>{const s=[];for(let e=0;e<t.length;e++){s.push([]);for(let a=0;a<t[e].length;a++)s[e].push(Number.MAX_SAFE_INTEGER)}for(const n of e)(0,a.iterateOnGameMap)({start:n,blocks:t,callback:(t,e)=>{const a=e.length;return s[t.y][t.x]=Math.min(s[t.y][t.x],a),!1}});return s},e.calcuateSafety=({position:t,blocks:s,dangers:a})=>(0,e.calculateSafetyMatrix)({blocks:s,dangers:a})[t.y][t.x],e.isPathSafeWithDagger=({daggerState:t,path:e})=>null!=t&&t.ticksLeft>3},410:(t,e,s)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.tick=e.getSortedIntents=void 0;const a=s(836),n=s(84),o=s(585),i=s(686),r=s(958),c=s(989),l=s(656),u=s(816);e.getSortedIntents=({state:t,stateHistory:e,intentHistory:s})=>{const f=t.players[t.playerId],p=Object.values(t.monsters),y=Object.values(t.players),d=p.map((t=>t.id)),g=(y.map((t=>t.id)),y.filter((e=>e.id!==t.playerId))),h=(0,l.calculateSafetyMatrix)({blocks:t.map.blocks,dangers:p.map((t=>t.position))}),b=(0,l.calculateVisibilityMatrix)({blocks:t.map.blocks,positions:p.map((t=>t.position))}),v={start:f.position,blocks:t.map.blocks,entities:[...p,...g]},k=(0,u.getPointsOfInterest)(v),x=(0,u.getPointsOfInterestWithSafety)(Object.assign(Object.assign({},v),{safetyMatrix:h,visibilityMatrix:b})),P=(0,u.getDangerousPointsOfInterest)({poi:k,safePoi:x}),M={state:t,player:f,safetyMatrix:h,visibilityMatrix:b};let O;O=null!=f.dagger?P.blocks.length>0?P:k:x.blocks.length>0?x:k;const S=Object.values(k.entities).filter((t=>d.includes(t.target))),m=[],_=(0,c.isInDanger)({player:f,position:f.position,safetyMatrix:h,visibilityMatrix:b});m.push(...(0,i.resolveDaggerIntent)(Object.assign(Object.assign({},M),{paths:[...k.blocks.filter((t=>t.target===l.Block.dagger)),...x.blocks.filter((t=>t.target===l.Block.dagger))]}))),_?m.push(...(0,c.resolveSafetyIntent)(Object.assign(Object.assign({},M),{paths:S}))):m.push(...(0,o.resolveCoinIntent)(Object.assign(Object.assign({},M),{paths:O.blocks.filter((t=>t.target===l.Block.coin))})),...(0,r.resolveKillIntent)(Object.assign(Object.assign({},M),{paths:S})),...(0,n.resolveBonusIntent)(Object.assign(Object.assign({},M),{paths:O.blocks.filter((t=>t.target===l.Block.bonus))})));const j=_?m:m.filter((e=>{const s=(0,c.escapePathsFromPosition)({player:f,dangers:p.map((t=>t.position)),position:f.position,safetyMatrix:h,state:t,visibilityMatrix:b});return null==s||s.length>0}));return 0===j.length?[{actions:[a.Action.stay],target:f.position,certainty:0,duration:0,payoff:0,validateSafety:!1}]:j.sort(((t,e)=>{const s=t.certainty*t.payoff,a=e.certainty*e.payoff,n=s/t.duration;return a/e.duration-n}))},e.tick=t=>{const s=(0,e.getSortedIntents)(t);return console.error(s.slice(0,5)),s[0]}},974:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.manhattanDistance=void 0,e.manhattanDistance=(t,e)=>Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},561:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Vector2=void 0;class s{constructor(t,e){this.x=t,this.y=e}add(t){return new s(this.x+t.x,this.y+t.y)}addMany(...t){return t.reduce(((t,e)=>t.add(e)),this)}sub(t){return new s(this.x-t.x,this.y-t.y)}equals(t){return this.x===t.x&&this.y===t.y}copy(){return new s(this.x,this.y)}toString(){return`(${this.x}, ${this.y})`}}e.Vector2=s},165:(t,e,s)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isVisible=e.calculateVisibilityMatrix=void 0;const a=s(601),n=s(656),o=s(974),i=(t,e,s,a,n)=>{const o=s-t;let i=a-e,r=1;i<0&&(r=-1,i=-i);let c=2*i-o,l=e;for(let e=t;e<=s&&!n(e,l);e++)c>0?(l+=r,c+=2*(i-o)):c+=2*i},r=(t,e,s,a,n)=>{let o=s-t;const i=a-e;let r=1;o<0&&(r=-1,o=-o);let c=2*o-i,l=t;for(let t=e;t<=a&&!n(l,t);t++)c>0?(l+=r,c+=2*(o-i)):c+=2*o};e.calculateVisibilityMatrix=({positions:t,blocks:e,radius:s})=>{const c=[],l=null!=s?s:a.Constants.defaultVisibilityRadius;for(let t=0;t<e.length;t++){c.push([]);for(let s=0;s<e[t].length;s++)c[t].push(!1)}for(const s of t)for(let t=0;t<e.length;t++)for(let a=0;a<e[t].length;a++){let g=!1;u=s.x,f=s.y,p=a,y=t,d=(t,a)=>{const i=new n.Vector2(t,a);return((0,o.manhattanDistance)(i,s)>=l||e[a][t]===n.Block.wall)&&(g=!0,!0)},Math.abs(y-f)<Math.abs(p-u)?u<p?i(u,f,p,y,d):i(p,y,u,f,d):f<y?r(u,f,p,y,d):r(p,y,u,f,d),c[t][a]=c[t][a]||!g}var u,f,p,y,d;return c},e.isVisible=({light:t,position:s,blocks:a})=>(0,e.calculateVisibilityMatrix)({positions:[t],blocks:a})[s.y][s.x]},147:t=>{"use strict";t.exports=require("fs")}},e={};function s(a){var n=e[a];if(void 0!==n)return n.exports;var o=e[a]={exports:{}};return t[a].call(o.exports,o,o.exports,s),o.exports}(()=>{"use strict";const t=s(532),e=s(410),a=[],n=[];for(;;)try{const s=(0,t.getState)({history:a}),o=(0,e.tick)({state:s,stateHistory:a,intentHistory:n});console.log(o.actions[0]),a.push(s),n.push(o)}catch(t){console.error(t)}})()})();